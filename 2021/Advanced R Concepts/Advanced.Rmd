---
title: "Advanced R for Econometricians"
subtitle: "Advanced R Concepts"
author: "Martin C. Arnold"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: ["default", "../assets/sydney-fonts.css", "../assets/sydney.css", "../assets/title_slides.css", "../xaringan_files/custom.css"]
    self_contained: false # if true, fonts will be stored locally
    seal: false # show a title slide with YAML information
    includes:
      in_header: "../assets/mathjax-equation-numbers.html"
      after_body: "../assets/copybutton.html"
    nature:
      beforeInit: ["../assets/remark-zoom.js", "../xaringan_files/macros.js", "https://platform.twitter.com/widgets.js"]
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: '16:9' # alternatives '16:9' or '4:3' or others e.g. 13:9
      navigation:
        scroll: false # disable slide transitions by scrolling
---

```{r icons, include = FALSE, eval = FALSE}
# manualy!
# install.packages("remotes")
#remotes::install_github("mitchelloharawild/icons")
#icons::download_fontawesome()
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning=FALSE, message=FALSE)
options(htmltools.dir.version = FALSE)
# packages needed
library(lobstr)
library(icons)

# pre-define icons
desktop <- fontawesome$solid$desktop

```

class: title-slide title-rintro center middle

# `r rmarkdown::metadata$title`
## `r rmarkdown::metadata$subtitle`
### `r rmarkdown::metadata$author`

---
## Overview

<style>
  strong {
    color:#e64626;
  }
  
</style>

Make sure the `lobstr` package is attached!

```{r, eval=F}
install.packages('lobstr')
library(lobstr)
```

**Outline**

- Names and values

    - Bindings and references

    - Copy-on-modify / in-place modification

    - Unbinding and Garbage Collection
    
- Functions
    
    - Fundamentals, scoping and Lazy Evaluation
    
    - Function forms

---
class: segue-red
### Names and Values

---
## Assignment Operators (?)

.smaller[

`<-` is often used for assignment but some people use `=` instead. There is, however, a subtle difference in how they are evaluated when mixed in the same expression. 

.blockquote.exercise[
#### `r desktop` Example: operator *precedence*

.pull-left[
```{r}
a <- b <- 1
a == b
a = b = 1
a == b
```
]
.pull-right[
```{r, error=TRUE}
a = b <- 1
a == b
a <- b = 1
```
]


]]

???

- This really is just a convention and nothing precludes using `=` instead of `<-` for assignment

- When mixed, `<-` has precedence over `=`

- **Fact**: `<-` comes from a time where there actually was a `<-` key on keyboards. `<-` and `->` essentially do the same thing.

- R interprets `a <- b = 1` as `'<-<-'(a, b = 1, value = 1)`

---
## Assignment Operators (?)

.smaller[

- For consistency we use `<-` for binding and `=` for assigning function arguments.

- Note, however, that there are reasonable [proposals](http://www.win-vector.com/blog/2016/12/the-case-for-using-in-r/comment-page-1/) for using other conventions.

<br>
.content-box-white[
**Task:** 

Find out what `->` does and think of an application where it might be useful.

*Hint:* Experiment to find out about the precedence relation between `<-`, `->` and `=`.
]]

???

- `->` is the right-assignment operator

- The precedence relation is `->` >> `<-` >> `=` so `x <- 1 -> b` is another working alternative to the last line on the previous slide

---
## Assignment Operators (?)

.smaller[
Assignment operators work in the environment they are invoked in. The super assignment operator `<<-` assigns in the enclosing environment, provided the binding exists there.

.blockquote.exercise[
#### `r desktop` Example: super assignment

```{r}
var_GE <- 1

a <- function(x) {
  b <- function(x) var_GE <<- x
  b(x)
}

a(3)
var_GE
```

]]

???

- Note that functions generate their own environments upon execution. The *execution environment* of `a()` is the parent environment to `b()`.

- If `<<-` does not find a corresponding binding in the enclosing environment, it looks in the parent environment and works it's way up towards to global environment (GE)

- If the binding does not exist in the GE, it will be created there